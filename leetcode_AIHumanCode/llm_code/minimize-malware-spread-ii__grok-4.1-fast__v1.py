import collections

class Solution(object):
    def minMalwareSpread(self, graph, initial):
        n = len(graph)
        infected = set(initial)
        safe = [i for i in range(n) if i not in infected]
        parent = list(range(n))
        rank = [0] * n
        csize = [1] * n
        
        def find(x):
            if parent[x] != x:
                parent[x] = find(parent[x])
            return parent[x]
        
        def link(u, v):
            pu, pv = find(u), find(v)
            if pu == pv:
                return
            if rank[pu] < rank[pv]:
                parent[pu] = pv
                csize[pv] += csize[pu]
            elif rank[pu] > rank[pv]:
                parent[pv] = pu
                csize[pu] += csize[pv]
            else:
                parent[pv] = pu
                csize[pu] += csize[pv]
                rank[pu] += 1
        
        for i in range(len(safe)):
            for j in range(i + 1, len(safe)):
                if graph[safe[i]][safe[j]]:
                    link(safe[i], safe[j])
        
        root_sizes = {}
        for node in safe:
            rt = find(node)
            root_sizes[rt] = csize[rt]
        
        conn = collections.defaultdict(set)
        for src in initial:
            for tgt in safe:
                if graph[src][tgt]:
                    rt = find(tgt)
                    conn[rt].add(src)
        
        gains = collections.defaultdict(int)
        for rt, srcs in conn.items():
            if len(srcs) == 1:
                inf = next(iter(srcs))
                gains[inf] += root_sizes[rt]
        
        max_gain = max(gains.values()) if gains else 0
        best = min(node for node in initial if gains[node] == max_gain)
        return best
